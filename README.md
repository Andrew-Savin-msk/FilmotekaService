# Filmoteka Microservices

## Описание

Проект состоит из нескольких микросервисов, обеспечивающих функциональность Filmoteka. Основные компоненты включают:

- **FilmotekaApi**: Сервис для работы с базой данных и бизнес-логикой.
- **Mail Sender**: Сервис для отправки приветственных писем новым пользователям с использованием библиотеки `gomail`.
- **RApache-Kafka**: Брокер сообщений, соединяющий FilmotekaApi и Mail Sender.
- **Frontend**: Визуальное представление нашего сервиса.
- **PostgreSQL**: База данных с таблицами `users`, `films`, `actors`, `actors_films`.

## Компоненты

### FilmotekaApi

**Описание**: Сервис, обеспечивающий работу с базой данных и бизнес-логикой.

**Основные функции**:
- Добавление, обновление и удаление информации о фильмах и актерах.
- Получение отсортированного списка фильмов.
- Поиск фильмов по фрагменту названия и актерам.
- Управление пользователями.

**Запуск**:
- Для запуска необходимо наличие запущенных БД и Брокера сообщений

**Структура конфигурационного файла**
```toml
[server]
  port = ":<номер_порта>"
  session_key = "<128_символьный_ключ>"
  log_level = "info/debug/error"

[database]
  db_type = "<тип_бд>"
  user = "<логин>"
  password = "<пароль>"
  host = "<хост>"
  db_name = "<название_бд>"

[broker_client]
  broker_type = "<тип_брокера>"
  user = "<логин>"
  password = "<пароль>"
  host = "<хост>"
  port = "<порт>"
  topic = "<топик_или_название_очереди>"

```

### Mail Sender

**Описание**: Сервис для отправки приветственных писем новым пользователям.

**Используемая библиотека**: `gomail`

**Запуск**:
- Для запуска необходим запущенный Брокер сообщений

**Структура конфигурационного файла**
```toml
[server]
  log_level = "info/debug/error"

[broker_client]
  broker_type = "<тип_брокера>"
  user = "<логин>"
  password = "<пароль>"
  host = "<хост>"
  port = "<порт>"
  topic = "<топик_или_название_очереди>"

[mail_sender]
  host = "<почтовый_хост>"
  login = "<отправляющая_почта>"
  app_password = "<пароль_приложения>"
  md_type = "<тип_почтового_клиента>"
  body_template_path = "<относительный_путь_от_папки_сервиса_до_шаблона_письма>"
```

### RabbitMQ

**Описание**: Брокер сообщений для связи между FilmotekaApi и Mail Sender.

### Frontend

**Описание**: Визуальное представление сервиса.

### PostgreSQL

**Описание**: База данных с таблицами `users`, `films`, `actors`, `actors_films`.

**Структура таблиц**:
- `users`: Таблица пользователей.
- `films`: Таблица фильмов.
- `actors`: Таблица актеров.
- `actors_films`: Связующая таблица между актерами и фильмами.

## Сборка и запуск всего проекта

Для запуска на Windows создайте .env файл, и определите все переменные по данной структуре:

```env
BACK_CONFIG_PATH="<путь_до_конфигурационного_файла_api_при_запуске_вне_контейнера>"
BACK_DOCKER_CONFIG_PATH="<путь_до_конфигурационного_файла_ api_при_запуске_в_контейнере>"
POSTGRES_USER="<логин_пользователя_в_бд>"
POSTGRES_PASSWORD="<пароль_пользователя_в_бд>"
POSTGRES_DB="<название_бд>"
MAIL_CONFIG_PATH="<путь_до_конфигурационного_файла_почтового_сервиса_при_запуске_вне_контейнера>"
MAIL_DOCKER_CONFIG_PATH="<путь_до_конфигурационного_файла_почтового_сервиса_при_запуске_в_контейнере>"
BROKER_USER="<логин_пользователя_брокера>"
BROKER_PASSWORD="<пароль_пользователя_брокера>"
BROKER_TOPIC_NAME="<топик_или_название_очереди>

```

Для запуска всех сервисов одновременно, используйте `docker-compose`:

```bash
docker-compose up --build
```
